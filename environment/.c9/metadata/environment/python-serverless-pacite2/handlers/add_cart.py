{"filter":false,"title":"add_cart.py","tooltip":"/python-serverless-pacite2/handlers/add_cart.py","undoManager":{"mark":0,"position":0,"stack":[[{"start":{"row":0,"column":0},"end":{"row":63,"column":0},"action":"insert","lines":["import json","from models.product import ProductModel","from utils.helpers import DecimalEncoder","","def handler(event, context):","    query_params = event.get(\"queryStringParameters\", {})","    product_id = query_params.get(\"product_id\") if query_params else None","    product_name = query_params.get(\"product_name\") if query_params else None","","    if not product_id and not product_name:","        return {","            \"statusCode\": 400,","            \"body\": json.dumps({\"status\": \"error\", \"message\": \"Product ID or Product Name is required\"})","        }","","    product_model = ProductModel()","    item = None","    ","    if product_id:","        item = product_model.get_one(product_id)","    elif product_name:","        item = product_model.get_by_name(product_name)","","    if not item:","        return {","            \"statusCode\": 404,","            \"body\": json.dumps({\"status\": \"error\", \"message\": \"Product not found\"})","        }","    ","    # Ask customer for quantity to purchase","    purchase_quantity = int(query_params.get(\"quantity\", 0))","    ","    if purchase_quantity <= 0:","        return {","            \"statusCode\": 400,","            \"body\": json.dumps({\"status\": \"error\", \"message\": \"Invalid purchase quantity\"})","        }","    ","    if purchase_quantity > item[\"quantity\"]:","        return {","            \"statusCode\": 400,","            \"body\": json.dumps({\"status\": \"error\", \"message\": f\"Only {item['quantity']} units available\"})","        }","    ","    # Deduct from stock","    new_stock = item[\"quantity\"] - purchase_quantity","    product_model.purchase_product(item[\"product_id\"], purchase_quantity)","    ","    # Simulate asking for payment details (not implemented)","    payment_details = \"Payment process completed\"  # Placeholder","    ","    return {","        \"statusCode\": 200,","        \"headers\": {","            \"Content-Type\": \"application/json\"","        },","        \"body\": json.dumps({","            \"status\": \"success\",","            \"message\": f\"Purchased {purchase_quantity} units of {item['product_name']}\",","            \"remaining_stock\": new_stock,","            \"payment_status\": payment_details","        }, cls=DecimalEncoder)","    }",""],"id":2}]]},"ace":{"folds":[],"scrolltop":180,"scrollleft":0,"selection":{"start":{"row":16,"column":15},"end":{"row":16,"column":15},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":29,"state":"start","mode":"ace/mode/python"}},"timestamp":1741761379553,"hash":"3c44dab3f411981146df4cb30b83fa821e62854e"}